# Chat Interface Implementation Guide for Replit

## Overview
Add a new chat interface section to the existing HTML webpage (superui.html) that integrates with a WebSocket-based AI chatbot backend.

## Project Files
- **Main HTML**: `superui.html` (existing file to be modified)
- **Styles**: `styles.css` (provided - use existing Frutiger Aero styling)
- **New Chat Page**: Create `chat.html` (new file)

---

## Step 1: Add Navigation Item to superui.html

In `superui.html`, add a new navigation item below the "Dynamic Testing" nav-item:

```html
<div class="nav-item" data-url="chat.html">
    <div class="nav-item-title">AI Chat Assistant</div>
    <div class="nav-item-desc">Conversational AI interface</div>
</div>
```

---

## Step 2: Create chat.html

Create a new file called `chat.html` with the following structure:

### HTML Structure Requirements

1. **Login Screen (Initial View)**
   - Center-aligned login form using `.login-screen` and `.login-container` classes from styles.css
   - Logo section with animated icon (use ü§ñ emoji with `.logo-icon-large` class)
   - Title: "AI Chat Assistant"
   - Two input fields:
     - Email (type="email", placeholder="Enter your email")
     - Password (type="password", placeholder="Enter your password")
   - Login button with `.btn-primary` and `.btn-large` classes
   - Login hint section showing available credentials

2. **Hardcoded User Credentials**
   ```javascript
   const users = {
       'studemouser@gktech.ai': 'Welcome@123',
       'studemoteacher@gktech.ai': 'Welcome@123'
   };
   ```

3. **Main Chat Interface (After Login)**
   - Use existing CSS classes from styles.css (`.navbar`, `.container`, `.glass`, etc.)
   - Header section with:
     - Logo/title
     - Bot selector dropdown (i-science / AI)
     - Theme toggle button
     - Logout button
   - Chat messages container (`.list-container` class for scrollable area)
   - Message input section at bottom with:
     - Textarea for user input
     - Send button

### Visual Structure (HTML Elements)
```html
<!-- Login Screen -->
<div id="loginScreen" class="login-screen">
    <div class="login-container glass">
        <!-- Logo, form, credentials hint -->
    </div>
</div>

<!-- Main Chat Interface (hidden initially) -->
<div id="chatInterface" style="display: none;">
    <!-- Background Animation -->
    <div class="background-animation">
        <div class="bubble bubble-1"></div>
        <!-- Add all 5 bubbles -->
    </div>
    
    <!-- Theme Toggle -->
    <div class="theme-toggle-container">
        <button class="theme-toggle">üåô</button>
    </div>
    
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <span class="logo-icon">ü§ñ</span>
                AI Chat Assistant
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <select id="botSelector" class="form-group select">
                    <option value="i-science">i-Science Bot</option>
                    <option value="AI">AI Bot</option>
                </select>
                <button id="logoutBtn" class="btn btn-secondary">Logout</button>
            </div>
        </div>
    </nav>
    
    <!-- Main Container -->
    <div class="container">
        <div class="card glass full-width">
            <!-- Messages Container -->
            <div id="messagesContainer" class="list-container" style="min-height: 500px; max-height: 60vh;">
                <!-- Messages will be added here dynamically -->
            </div>
            
            <!-- Input Section -->
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <textarea id="userInput" placeholder="Type your message..." rows="2" style="flex: 1;"></textarea>
                <button id="sendBtn" class="btn btn-primary">Send</button>
            </div>
        </div>
    </div>
</div>
```

---

## Step 3: JavaScript Implementation

### A. Authentication Logic

```javascript
// On page load, show login screen
document.addEventListener('DOMContentLoaded', function() {
    // Hardcoded credentials
    const users = {
        'studemouser@gktech.ai': 'Welcome@123',
        'studemoteacher@gktech.ai': 'Welcome@123'
    };
    
    let currentUser = null;
    
    // Login handler
    document.getElementById('loginBtn').addEventListener('click', function() {
        const email = document.getElementById('emailInput').value;
        const password = document.getElementById('passwordInput').value;
        
        if (users[email] && users[email] === password) {
            currentUser = email;
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('chatInterface').style.display = 'block';
            initializeChat();
        } else {
            alert('Invalid credentials');
        }
    });
    
    // Logout handler
    document.getElementById('logoutBtn').addEventListener('click', function() {
        currentUser = null;
        conversationId = null;
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('chatInterface').style.display = 'none';
        document.getElementById('messagesContainer').innerHTML = '';
    });
});
```

### B. Conversation Initialization

```javascript
let conversationId = null;
let currentBot = 'i-science';
let ws = null;

async function initializeChat() {
    // Get selected bot
    currentBot = document.getElementById('botSelector').value;
    
    // Create new conversation
    try {
        const response = await fetch(
            `https://stu.globalknowledgetech.com:8000/conversations/createnull?user_uuid=${encodeURIComponent(currentUser)}&bot_id=${currentBot}`
        );
        const data = await response.json();
        conversationId = data.conversation_uuid;
        
        console.log('Conversation created:', conversationId);
        
        // Add welcome message
        addMessage('assistant', 'Hello! I\'m your AI assistant. How can I help you today?');
    } catch (error) {
        console.error('Error creating conversation:', error);
        alert('Failed to initialize chat. Please try again.');
    }
}

// Bot selector change handler
document.getElementById('botSelector').addEventListener('change', function() {
    if (confirm('Switching bots will start a new conversation. Continue?')) {
        initializeChat();
        document.getElementById('messagesContainer').innerHTML = '';
    } else {
        this.value = currentBot; // Revert selection
    }
});
```

### C. WebSocket Connection & Message Handling

```javascript
function sendMessage() {
    const input = document.getElementById('userInput');
    const message = input.value.trim();
    
    if (!message || !conversationId) return;
    
    // Add user message to UI
    addMessage('user', message);
    input.value = '';
    
    // Connect to WebSocket
    connectWebSocket(message);
}

function connectWebSocket(userMessage) {
    // Close existing connection if any
    if (ws) {
        ws.close();
    }
    
    // Create WebSocket connection
    ws = new WebSocket('wss://stu.globalknowledgetech.com:8000/generate/response/stream');
    
    let assistantMessageId = null;
    let fullResponse = '';
    
    ws.onopen = function() {
        console.log('WebSocket connected');
        
        // Send message payload
        const payload = {
            input: userMessage,
            user_id: currentUser,
            language: "en",
            bot_details: {
                collection: currentBot,
                top_k: 5
            },
            convo_id: conversationId,
            temperature: 0.7,
            max_tokens: 2048
        };
        
        ws.send(JSON.stringify(payload));
        
        // Create assistant message placeholder
        assistantMessageId = addMessage('assistant', '');
    };
    
    ws.onmessage = function(event) {
        const chunk = event.data;
        fullResponse += chunk;
        
        // Update message with streaming content
        updateMessage(assistantMessageId, fullResponse);
    };
    
    ws.onerror = function(error) {
        console.error('WebSocket error:', error);
        updateMessage(assistantMessageId, 'Error: Failed to get response');
    };
    
    ws.onclose = function() {
        console.log('WebSocket closed');
        ws = null;
    };
}

// Send button handler
document.getElementById('sendBtn').addEventListener('click', sendMessage);

// Enter key handler (Shift+Enter for new line, Enter to send)
document.getElementById('userInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
    }
});
```

### D. Message Display with Markdown Rendering

**IMPORTANT**: Include marked.js library for markdown rendering

```html
<!-- Add in <head> section of chat.html -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
```

```javascript
let messageIdCounter = 0;

function addMessage(role, content) {
    const messagesContainer = document.getElementById('messagesContainer');
    const messageId = `msg-${messageIdCounter++}`;
    
    const messageDiv = document.createElement('div');
    messageDiv.id = messageId;
    messageDiv.className = `list-item ${role === 'user' ? 'user-message' : 'assistant-message'}`;
    
    // Render markdown for assistant messages
    const renderedContent = role === 'assistant' ? marked.parse(content || '...') : content;
    
    messageDiv.innerHTML = `
        <div style="font-weight: 600; margin-bottom: 5px; color: var(--accent-blue);">
            ${role === 'user' ? 'üë§ You' : 'ü§ñ Assistant'}
        </div>
        <div class="message-content">${renderedContent}</div>
    `;
    
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    
    return messageId;
}

function updateMessage(messageId, content) {
    const messageDiv = document.getElementById(messageId);
    if (messageDiv) {
        const contentDiv = messageDiv.querySelector('.message-content');
        contentDiv.innerHTML = marked.parse(content);
        
        // Auto-scroll to bottom
        const container = document.getElementById('messagesContainer');
        container.scrollTop = container.scrollHeight;
    }
}
```

### E. Theme Toggle (Reuse from styles.css)

```javascript
// Theme toggle handler
document.querySelector('.theme-toggle').addEventListener('click', function() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    html.setAttribute('data-theme', newTheme);
    this.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
});

// Initialize theme (default to light)
document.documentElement.setAttribute('data-theme', 'light');
```

---

## Step 4: CSS Styling Notes

Use these existing classes from `styles.css`:

- **Layout**: `.container`, `.navbar`, `.nav-container`
- **Cards**: `.glass`, `.card`, `.full-width`
- **Buttons**: `.btn`, `.btn-primary`, `.btn-secondary`
- **Forms**: `.form-group`, `input`, `textarea`, `select`
- **Lists**: `.list-container`, `.list-item`
- **Login**: `.login-screen`, `.login-container`, `.login-hint`
- **Animation**: `.background-animation`, `.bubble`

### Additional Custom Styles for Messages

Add these custom styles in a `<style>` tag in chat.html:

```css
.user-message {
    background: var(--gradient-button-primary) !important;
    color: white;
    margin-left: 20%;
}

.assistant-message {
    margin-right: 20%;
}

.message-content {
    line-height: 1.6;
}

.message-content code {
    background: rgba(0, 0, 0, 0.1);
    padding: 2px 6px;
    border-radius: 4px;
}

.message-content pre {
    background: rgba(0, 0, 0, 0.1);
    padding: 10px;
    border-radius: 8px;
    overflow-x: auto;
}
```

---

## Step 5: Error Handling

Implement these error scenarios:

1. **Failed API Connection**: Show error message in chat
2. **WebSocket Disconnect**: Notify user and allow retry
3. **Invalid Bot Selection**: Prevent sending until conversation is initialized
4. **Network Errors**: Display user-friendly error messages

```javascript
function handleError(error, context) {
    console.error(`Error in ${context}:`, error);
    addMessage('assistant', `‚ùå Error: ${error.message || 'Something went wrong. Please try again.'}`);
}
```

---

## Step 6: Testing Checklist

- [ ] Login with both user credentials works
- [ ] Logout and re-login works correctly
- [ ] Bot selection creates new conversation
- [ ] Messages send successfully
- [ ] Streaming responses display correctly
- [ ] Markdown rendering works (test code blocks, lists, bold, etc.)
- [ ] Theme toggle works
- [ ] Scroll to bottom on new messages
- [ ] Enter key sends message
- [ ] Error handling displays properly
- [ ] UI matches existing Frutiger Aero design

---

## Important Notes

1. **CORS**: Backend must allow requests from your domain
2. **HTTPS**: Replit provides HTTPS by default, which is required for WSS connections
3. **WebSocket**: Connection URL is `wss://` (secure WebSocket)
4. **Markdown**: Use marked.js for rendering assistant responses
5. **Styling**: Maintain consistency with existing styles.css design
6. **State Management**: Track `currentUser`, `conversationId`, `currentBot`, and `ws` connection

---

## File Structure Summary

```
project/
‚îú‚îÄ‚îÄ superui.html (modified - add nav item)
‚îú‚îÄ‚îÄ chat.html (new - complete chat interface)
‚îî‚îÄ‚îÄ styles.css (existing - no changes needed)
```

---

## Quick Start Commands for Replit

1. Open `superui.html` and add the navigation item
2. Create new file `chat.html`
3. Copy the complete HTML structure
4. Add all JavaScript code in `<script>` tags
5. Test with provided credentials
6. Deploy and test WebSocket connection

---

## Expected Behavior

1. User opens superui.html ‚Üí clicks "AI Chat Assistant"
2. Login screen appears with hardcoded credentials
3. After login, chat interface loads
4. Conversation initializes automatically with selected bot
5. User types message ‚Üí sends via WebSocket
6. Response streams in real-time with markdown formatting
7. User can switch bots (creates new conversation)
8. Theme toggle and logout work as expected